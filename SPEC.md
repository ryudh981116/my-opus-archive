# My Opus Archive - 기능명세서 (SPEC)

## 📋 목차
1. [프로젝트 개요](#프로젝트-개요)
2. [주요 기능](#주요-기능)
3. [사용자 입력 항목](#사용자-입력-항목)
4. [데이터 처리 방식](#데이터-처리-방식)
5. [예외 처리](#예외-처리)
6. [배포 환경 요구사항](#배포-환경-요구사항)

---

## 프로젝트 개요

### 목적
클래식 공연의 연주자들이 자신의 공연 내역을 **체계적으로 관리**하고, **커뮤니티를 통해 공유**할 수 있는 웹 플랫폼 제공

### 대상 사용자
- 클래식 공연 연주자 (전문가, 아마추어)
- 음악 애호가
- 지휘자, 악단 관계자

### 핵심 가치
- ✅ **개인 아카이브**: 연주 내역을 영구 보관
- ✅ **공개/비공개 선택**: 사생활 보호와 공유 필요성 모두 충족
- ✅ **커뮤니티**: 다른 음악가와 소통
- ✅ **검색/필터**: 빠른 정보 조회

---

## 주요 기능

### 1. 🔐 사용자 인증 페이지

#### 1.1 회원가입
- **화면**: 사이드바 → "회원가입" 탭
- **입력 항목**:
  - `사용자명` (text input): 4-20자, 영문/숫자/_만 허용
  - `이메일` (text input): 유효한 이메일 형식 필수
  - `비밀번호` (password input): 6자 이상
  - `비밀번호 확인` (password input): 위와 동일해야 함
- **동작**: 
  - 모든 필드 필수 입력
  - 중복 체크 (username, email)
  - 성공 시 로그인 페이지로 안내
  - 실패 시 오류 메시지 표시
- **저장 위치**: `data/users.json`

#### 1.2 로그인
- **화면**: 사이드바 → "로그인" 탭
- **입력 항목**:
  - `사용자명` (text input)
  - `비밀번호` (password input)
- **동작**:
  - 자격증명 검증
  - 성공 시 세션 상태 업데이트 → 메인 페이지 리로드
  - 실패 시 오류 메시지 표시

#### 1.3 로그아웃
- **위치**: 사이드바
- **동작**: 로그인 상태 초기화 → 홈페이지로 리다이렉트

---

### 2. 📚 내 연주 내역 페이지

#### 2.1 연주 내역 조회
- **화면**: 왼쪽 메뉴 → "내 연주 내역"
- **표시 정보**:
  - 연주 장소 (📍)
  - 연주 날짜 (📅)
  - 악기 & 세부파트 (🎻)
  - 단체명 (🎼)
  - 지휘자 (🎩)
  - 곡목 목록
  - 공개/비공개 상태 (🌍/🔒)
  - 유튜브 링크 (선택사항)
- **정렬**: 최신순 (역순)
- **조건부 표시**:
  - 인원이 없으면 "아직 연주 내역이 없습니다" 메시지

#### 2.2 연주 내역 수정
- **버튼**: 각 연주 항목의 ✏️ 버튼
- **기능**: 추후 업데이트 (현재 미구현)

#### 2.3 연주 내역 삭제
- **버튼**: 각 연주 항목의 🗑️ 버튼
- **동작**:
  - 확인 없이 즉시 삭제 (추후 개선 - 확인 팝업 추가)
  - 관련 댓글 및 좋아요도 함께 삭제
  - 화면 리로드

---

### 3. ✏️ 새 연주 기록 페이지

#### 3.1 연주 내역 입력 폼

**필수 정보**:
- `연주회 날짜`: date picker
- `연주 장소`: text input (예: 예술의전당 콘서트홀)
- `지휘자`: text input
- `단체명`: text input
- `악기`: text input
- `세부 파트`: text input (예: 1st Violin)
- `곡목`: 1부/2부/앵콜 체크박스 + 텍스트 영역
  - 각 부는 수행/미수행 선택 가능
  - 여러 곡 입력 가능 (줄바꿈으로 구분)

**선택사항**:
- `객원 출연`: 체크박스
  - ✅시 → `페이 (원)` 수치 입력 추가
- `공개 여부`: 체크박스
  - ✅시 → 다른 사용자가 공개 아카이브에서 조회 가능
- `유튜브 영상 URL`: text input
- `포스터 이미지 URL`: text input

#### 3.2 폼 검증
- 모든 필수 정보 입력 확인
- 비어있는 필드 있으면 오류 메시지

#### 3.3 데이터 저장
- **저장 위치**: `data/performances.json`
- **저장 정보**:
  ```json
  {
    "perf_idx": {
      "id": "perf_1234567890.123",
      "user_id": "username",
      "date": "2025-02-13",
      "venue": "예술의전당",
      "pieces": ["1부: 곡1, 곡2", "2부: 곡3"],
      "instrument": "바이올린",
      "sub_part": "1st Violin",
      "is_guest": true,
      "guest_fee": 50000,
      "conductor": "라포",
      "ensemble_name": "서울 필",
      "is_public": true,
      "youtube_url": "https://...",
      "poster_url": "https://...",
      "created_at": "2025-02-13T10:30:45"
    }
  }
  ```
- **성공 메시지**: "✅ 연주 내역이 저장되었습니다!"

---

### 4. 🌍 공개 아카이브 페이지

#### 4.1 공개 연주 내역 조회
- **표시 대상**: `is_public == true`인 모든 연주
- **정렬**: 최신순
- **표시 정보**:
  - 사용자명 (👤)
  - 연주 장소 (📍)
  - 연주 날짜 (📅)
  - 악기 & 세부파트 (🎻)
  - 단체명 (🎼)
  - 지휘자 (🎩)
  - 곡목 (최대 3개만 미리보기)
  - 유튜브 링크 (선택사항)

#### 4.2 좋아요 기능
- **버튼**: 각 연주의 우측 상단 "❤️/🤍" 버튼
- **기능**:
  - 토글 방식 (좋아요 ↔ 좋아요 취소)
  - 좋아요 개수 표시
  - 이미 좋아요한 경우 ❤️ 표시, 하지 않은 경우 🤍 표시
- **저장 위치**: `data/likes.json`
  ```json
  {
    "perf_1234567890.123_username": {
      "performance_id": "perf_1234567890.123",
      "user_id": "username",
      "created_at": "2025-02-13T10:30:45"
    }
  }
  ```

#### 4.3 댓글 기능
- **표시**: 각 연주 아래 💬 섹션
- **댓글 조회**: 등록된 모든 댓글 시간순 표시
- **댓글 작성**: 텍스트 input + "댓글 작성" 버튼
- **댓글 삭제**: 자신의 댓글에만 "삭제" 버튼 표시
- **저장 위치**: `data/comments.json`
  ```json
  {
    "comment_1234567890.123": {
      "id": "comment_1234567890.123",
      "performance_id": "perf_1234567890.123",
      "user_id": "commenter",
      "content": "멋진 연주였습니다!",
      "created_at": "2025-02-13T10:30:45"
    }
  }
  ```

#### 4.4 조건부 표시
- 공개된 연주가 없으면 "아직 공개된 연주 내역이 없습니다" 메시지

---

### 5. 🔍 검색 및 필터 페이지

#### 5.1 필터 옵션
- `장소`: 텍스트 (부분 검색)
- `지휘자`: 텍스트 (부분 검색)
- `단체명`: 텍스트 (부분 검색)
- `악기`: 텍스트 (부분 검색)
- `시작 날짜`: date picker
- `종료 날짜`: date picker

#### 5.2 검색 범위
- 라디오 버튼: "내 연주 내역만" / "공개 아카이브"

#### 5.3 검색 동작
- "🔍 검색" 버튼 클릭 → 필터 적용
- 모든 필터 조건을 AND로 결합 (모두 만족해야 함)
- 결과 건수 표시
- 결과 없으면 안내 메시지

#### 5.4 결과 표시
- 사용자명 (👤)
- 연주 장소 (📍)
- 연주 날짜 (📅), 악기 (🎻), 지휘자 (🎩)
- 곡목 미리보기

---

## 사용자 입력 항목

| 항목 | 유형 | 필수 | 제약사항 | 예시 |
|------|------|------|---------|------|
| 사용자명 | text | ✅ | 4-20자, 중복 불가 | ryudh981116 |
| 이메일 | email | ✅ | 유효 형식, 중복 불가 | user@example.com |
| 비밀번호 | password | ✅ | 6자 이상 | ******* |
| 연주회 날짜 | date | ✅ | YYYY-MM-DD | 2025-02-13 |
| 연주 장소 | text | ✅ | - | 예술의전당 콘서트홀 |
| 지휘자 | text | ✅ | - | 라포 시닉 |
| 단체명 | text | ✅ | - | 서울 필하모닉 |
| 악기 | text | ✅ | - | 바이올린 |
| 세부 파트 | text | ✅ | - | 1st Violin |
| 곡목 (1부/2부/앵콜) | textarea | ✅ | 1개 이상 필수 | 차이코프스키 바이올린 협주곡 |
| 객원 여부 | checkbox | - | - | - |
| 페이 (객원시) | number | - | 0 이상 정수 | 50000 |
| 공개 여부 | checkbox | - | - | - |
| 유튜브 URL | text | - | 유효한 URL | https://www.youtube.com/... |
| 포스터 URL | text | - | 유효한 URL | https://... |
| 댓글 내용 | text | ✅ (댓글 작성시) | 공백 불가 | 멋진 연주였습니다! |

---

## 데이터 처리 방식

### 데이터 저장소
- **저장 방식**: JSON 파일 기반
- **저장 위치**: `./data/` 디렉토리
  - `users.json`: 사용자 정보
  - `performances.json`: 연주 내역
  - `comments.json`: 댓글
  - `likes.json`: 좋아요

### 데이터 유지 방식
1. **메모리 (세션)**: Streamlit `st.session_state`
   - 로그인 상태 (`logged_in`)
   - 현재 사용자 (`current_user`)
2. **파일시스템**: JSON 파일로 영속성 관리

### 데이터 흐름
```
사용자 입력 → Streamlit Form → 유효성 검증 → JSON 파일 저장 → UI 리렌더링
```

### 데이터 조회
- 사용자별 연주내역: `load_json()` → `filter()` → 정렬
- 공개 연주: 모든 데이터 → `is_public == True` 필터 → 정렬

---

## 예외 처리

### 인증 관련

| 상황 | 오류 메시지 | 처리 방법 |
|------|-----------|---------|
| 이미 존재하는 사용자명 | "이미 존재하는 사용자명입니다." | UI에 빨간 경고 표시 |
| 이미 등록된 이메일 | "이미 등록된 이메일입니다." | UI에 빨간 경고 표시 |
| 존재하지 않는 사용자 | "존재하지 않는 사용자입니다." | UI에 빨간 경고 표시 |
| 잘못된 비밀번호 | "비밀번호가 일치하지 않습니다." | UI에 빨간 경고 표시 |
| 비밀번호 미일치 | "비밀번호가 일치하지 않습니다." | 회원가입 폼에 경고 표시 |

### 데이터 입력 관련

| 상황 | 오류 메시지 | 처리 방법 |
|------|-----------|---------|
| 필수 필드 미입력 | "필수 정보를 모두 입력해주세요." | UI에 빨간 경고 표시 |
| 곡목 미입력 | "곡목을 1개 이상 입력해주세요." | UI에 빨간 경고 표시 |
| 댓글 공백 | "댓글을 입력해주세요." | UI에 노란 경고 표시 |

### 데이터 없음 관련

| 상황 | 메시지 | UI 표시 |
|------|-------|--------|
| 연주 내역 없음 | "아직 연주 내역이 없습니다." | 정보 박스 (파란색) |
| 공개 연주 없음 | "아직 공개된 연주 내역이 없습니다." | 정보 박스 (파란색) |
| 검색 결과 없음 | "검색 결과가 없습니다." | 정보 박스 (파란색) |
| 댓글 없음 | "_등록된 댓글이 없습니다._" | 캡션 텍스트 |

---

## 배포 환경 요구사항

### Python 버전
- Python **3.11.x** 또는 **3.12.x**

### 필수 패키지
| 패키지 | 버전 | 용도 |
|--------|------|------|
| streamlit | 1.54.0 | 웹 프레임워크 |

### 선택 패키지 (향후 확장)
| 패키지 | 용도 |
|--------|------|
| python-dotenv | 환경 변수 관리 |
| sqlalchemy | 데이터베이스 추상화 |
| bcrypt | 비밀번호 해싱 |
| psycopg2 | PostgreSQL 드라이버 |

### 시스템 요구사항
- 디스크 공간: 최소 100MB
- 메모리: 최소 512MB
- 인터넷: 옵션 (유튜브/이미지 URL 참조시 필요)

### Streamlit Cloud 배포
1. 이 리포지토리를 GitHub에 푸시
2. https://share.streamlit.io 접속
3. 리포지토리 연결
4. `streamlit run app.py` 설정

### 로컬 실행
```bash
# 1. 의존성 설치
pip install -r requirements.txt

# 2. 앱 실행
streamlit run app.py

# 브라우저에서 http://localhost:8501 접속
```

---

## 향후 스크린샷 추가 위치

- [ ] 로그인 화면
- [ ] 회원가입 화면
- [ ] 내 연주 내역 조회 화면
- [ ] 새 연주 기록 작성 화면
- [ ] 공개 아카이브 조회 화면
- [ ] 검색/필터 화면
- [ ] 모바일 반응형 UI

---

## 버전 히스토리

### v1.0 (2025-02-13)
- ✅ 초기 릴리스
- ✅ 기본 CRUD 기능
- ✅ 검색/필터
- ✅ 댓글/좋아요 기능
- ✅ 공개/비공개 설정

---

_마지막 업데이트: 2025-02-13_
